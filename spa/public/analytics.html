<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Screenpop Analytics</title>
    <meta name="color-scheme" content="light dark" />
    <style>
      :root{ --line:#e5e7eb; --muted:#6b7280; --brand:#4f46e5; }
      *{ box-sizing:border-box }
      html,body{ height:100% }
      body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#f5f7fb; color:#111827; }
      header{ display:flex; align-items:center; justify-content:space-between; padding:10px 14px; background:linear-gradient(180deg,#f9fafb,#f3f4f6); border-bottom:1px solid var(--line) }
      .wrap{ display:grid; grid-template-columns: 1fr; gap:12px; padding:12px; min-height:calc(100% - 56px) }
      .panel{ background:#fff; border:1px solid var(--line); border-radius:12px; overflow:hidden; display:flex; flex-direction:column }
      .panel h2{ margin:0; padding:10px 12px; font-size:14px; border-bottom:1px solid var(--line); background:#f9fafb }
      .panel .body{ flex:1; overflow:auto }
      table{ width:100%; border-collapse:collapse; font-size:13px }
      .toolbar{ display:flex; gap:8px; align-items:center; padding:8px 12px; border-bottom:1px solid var(--line); background:#fff; flex-wrap:wrap }
      button{ height:32px; padding:0 10px; border-radius:8px; border:1px solid var(--line); background:#fff; cursor:pointer; font-weight:600 }
      button.primary{ background:var(--brand); border-color:var(--brand); color:#fff }
      .tab-toggle{ display:inline-flex; border:1px solid var(--line); border-radius:8px; overflow:hidden; background:#fff }
      .tab-toggle button{ border:none; border-right:1px solid var(--line); background:transparent; padding:6px 12px; font-weight:600; cursor:pointer; color:#111827 }
      .tab-toggle button:last-child{ border-right:none }
      .tab-toggle button.active{ background:#eef2ff; color:#1f2937 }
      canvas.chart{ width:100%; height:180px; display:block }
      th, td{ text-align:left; padding:8px; border-bottom:1px solid var(--line); vertical-align:top }
      th{ position:sticky; top:0; background:#f9fafb; z-index:1 }
      .muted{ color:var(--muted) }
      .empty{ padding:16px; color:var(--muted) }
      /* Dashboard grids */
      .kpi-grid{ display:grid; grid-template-columns: repeat(2,minmax(140px,1fr)); gap:8px; padding:8px; border-bottom:1px solid var(--line); background:#fff }
      .kpi{ background:#f9fafb; border:1px solid var(--line); border-radius:10px; padding:8px 10px }
      .kpi .label{ color:var(--muted); font-size:12px }
      .kpi .value{ font-weight:700; font-size:18px }
      .charts{ display:grid; grid-template-columns: repeat(auto-fit, minmax(420px, 1fr)); gap:16px; align-items:stretch }
      .panel.wide{ grid-column: 1 / -1 }
      .panel .body{ padding:8px }
      .panel.table-panel .body{ padding:0; overflow:auto }
      .panel.table-panel table{ min-width:860px }
      #chartApptTypes{ height:240px }
      table thead th:nth-child(6), table tbody td:nth-child(6){ min-width:160px }
      tbody tr:nth-child(even){ background:#f9fafb }
      @media (min-width: 1024px){ .kpi-grid{ grid-template-columns: repeat(6,minmax(140px,1fr)); } }
      @media (max-width: 980px){ .wrap{ grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <header>
      <strong>Screenpop Analytics</strong>
      <div class="muted">Updates on “Done” from any screenpop tab</div>
    </header>
    <div class="wrap" style="grid-template-columns: 1fr; gap:12px;">
      <div class="panel" style="padding-bottom:0">
        <div class="toolbar" style="justify-content:space-between; border-bottom:0">
          <div style="display:flex;gap:6px;flex-wrap:wrap">
            <button id="exportCsvBtn">Export CSV</button>
            <button id="clearBtn">Clear</button>
            <input id="mrnSearch" type="text" placeholder="Search MRN" style="height:32px;padding:0 10px;border:1px solid var(--line);border-radius:8px" />
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div role="tablist" aria-label="Range" class="tab-toggle">
              <button id="tabDaily" role="tab" data-view="daily" aria-selected="true" class="active" type="button">Daily</button>
              <button id="tabMonthly" role="tab" data-view="monthly" aria-selected="false" type="button">Monthly</button>
            </div>
            <span id="dailyDateLabel" class="muted"></span>
            <input id="monthPicker" type="month" style="display:none;height:32px;padding:0 8px;border:1px solid var(--line);border-radius:8px" />
            <button id="rolloverNow" title="TEST ONLY — roll daily into monthly" style="display:none;height:32px;padding:0 10px;border-radius:8px;border:1px solid var(--line);background:#fff;cursor:pointer">Rollover Now</button>
            <div class="muted" id="countBadge"></div>
          </div>
        </div>
        <div class="kpi-grid">
          <div class="kpi"><div class="label">Total Calls</div><div class="value" id="kpiTotal">0</div></div>
          <div class="kpi"><div class="label">Cancellations</div><div class="value" id="kpiCancel">0</div></div>
          <div class="kpi"><div class="label">Reschedules</div><div class="value" id="kpiResched">0</div></div>
          <div class="kpi"><div class="label">New</div><div class="value" id="kpiNew">0</div></div>
          <div class="kpi"><div class="label">Existing</div><div class="value" id="kpiExisting">0</div></div>
          <div class="kpi"><div class="label">Tasks / Transfers</div><div class="value" id="kpiActions">0 / 0</div></div>
        </div>
      </div>
      <div class="charts">
        <div class="panel wide"><h2>Time Distribution (8am–5pm)</h2><div class="body"><canvas id="chartHours" class="chart"></canvas></div></div>
        <div class="panel wide" id="panelWeekdays"><h2>Weekday Distribution (Mon–Fri)</h2><div class="body"><canvas id="chartWeekdays" class="chart"></canvas></div></div>
        <div class="panel"><h2>New vs Existing</h2><div class="body"><canvas id="chartNewExisting" class="chart"></canvas></div></div>
        <div class="panel"><h2>Appointment Types</h2><div class="body"><canvas id="chartApptTypes" class="chart"></canvas></div></div>
        <div class="panel"><h2>Cancel Reasons</h2><div class="body"><canvas id="chartCancelReasons" class="chart"></canvas></div></div>
        <div class="panel"><h2>Reschedule Reasons</h2><div class="body"><canvas id="chartReschedReasons" class="chart"></canvas></div></div>
        <div class="panel"><h2>Tasks by Type</h2><div class="body"><canvas id="chartTasksByType" class="chart"></canvas></div></div>
        <div class="panel"><h2>Transfers by Type</h2><div class="body"><canvas id="chartTransfersByType" class="chart"></canvas></div></div>
      </div>

      <div class="panel table-panel">
        <h2>Submissions</h2>
        <div class="body">
          <table id="analyticsTable" aria-label="Screenpop submissions">
            <thead>
              <tr>
                <th>Time</th>
                <th>MRN</th>
                <th>Type</th>
                <th>Scheduled</th>
                <th>Change</th>
                <th>Appt Type</th>
                <th>Reason</th>
                <th>Other</th>
                <th>Tasks</th>
                <th>Transfers</th>
              </tr>
            </thead>
            <tbody id="analyticsBody">
              <tr class="empty"><td colspan="10">No submissions yet</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script src="./analytics.js" type="module"></script>
  </body>
  </html>
