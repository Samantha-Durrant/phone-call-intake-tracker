<!DOCTYPE html>
<!-- Version: testing — adds a scenario dropdown to simulate common calls -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Call Screenpop — Testing (Scenarios)</title>
  <link rel="stylesheet" href="screenpop.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous" />
  <meta name="color-scheme" content="light dark" />
  <style>
    body { background:#f5f7fb; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .demo-bar { position: fixed; top: 16px; left: 16px; z-index: 9; display: flex; gap: 8px; align-items: center; background: #fff; border:1px solid #e5e7eb; border-radius: 10px; padding: 8px 10px; box-shadow: 0 8px 24px rgba(0,0,0,.08); }
    .demo-bar select { height: 34px; border:1px solid #e5e7eb; border-radius: 8px; padding: 0 8px; font-size: 14px; }
    .demo-bar button { height: 34px; border-radius: 8px; border:1px solid #e5e7eb; background:#fff; cursor:pointer; padding:0 10px; font-weight:600; }
    .demo-bar .primary { background:#4f46e5; border-color:#4f46e5; color:#fff; }
    .demo-bar .primary:hover { background:#4338ca; }
    .mini-screenpop { bottom: 16px; right: 16px; }
  </style>
</head>
<body>
  <div class="demo-bar">
    <i class="fa-solid fa-vials" aria-hidden="true"></i>
    <label for="scenario" style="font-size:13px;color:#374151;">Scenario:</label>
    <select id="scenario" aria-label="Simulation Scenario">
      <option value="existing_cancel">Existing Patient — Cancellation</option>
      <option value="existing_reschedule">Existing Patient — Reschedule</option>
      <option value="confirm">Existing Patient — Confirmation</option>
      <option value="ma_call">Existing Patient — Returning MA Call</option>
      <option value="results_call">Existing Patient — Returning Results Call</option>
      <option value="provider_question">Existing Patient — Provider Question</option>
      <option value="refill_request">Existing Patient — Refill Request</option>
      <option value="billing_question">Existing Patient — Billing Question</option>
      <option disabled>──────────</option>
      <option value="new_cancel">New Patient — Cancellation</option>
      <option value="new_reschedule">New Patient — Reschedule</option>
      <option value="new_confirm">New Patient — Confirmation</option>
      <option value="new_ma_call">New Patient — Returning MA Call</option>
      <option value="new_results_call">New Patient — Returning Results Call</option>
      <option value="new_provider_question">New Patient — Provider Question</option>
      <option value="new_refill_request">New Patient — Refill Request</option>
      <option value="new_billing_question">New Patient — Billing Question</option>
      <option disabled>──────────</option>
      <option value="true_new_blank">True New Patient — No CRM Data</option>
      <option value="true_new_cancel">True New Patient — Cancellation</option>
      <option value="true_new_reschedule">True New Patient — Reschedule</option>
      <option value="true_new_confirm">True New Patient — Confirmation</option>
      <option value="true_new_ma_call">True New Patient — Returning MA Call</option>
      <option value="true_new_results_call">True New Patient — Returning Results Call</option>
      <option value="true_new_provider_question">True New Patient — Provider Question</option>
      <option value="true_new_refill_request">True New Patient — Refill Request</option>
      <option value="true_new_billing_question">True New Patient — Billing Question</option>
      <option disabled>──────────</option>
      <option value="household_match">Household Phone — Multiple Matches</option>
      <option value="no_match_phone">No Match — Search Subject</option>
      <option value="proxy_flow">Proxy Call — Someone Else</option>
    </select>
    <button id="runScenario" class="primary">Run</button>
    <button id="resetScenario">Reset</button>
  </div>

  <!-- Screenpop UI -->
  <div class="mini-screenpop" role="dialog" aria-label="Call Screenpop">
    <header class="mini-header">
      <div class="title">
        <i class="fa-solid fa-phone"></i>
        <span>Call Screenpop (Testing)</span>
        <span id="callerBadge" class="chip alt hidden" aria-hidden="true"></span>
      </div>
      <button class="icon-btn" aria-label="Close" title="Close" onclick="window.close?.()">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </header>

    <div class="mini-body">
    <section class="section">
      <h3 class="section-title"><i class="fa-regular fa-user"></i> Patient</h3>
      <div class="row" style="margin-bottom:.5rem">
        <span class="label">Call For</span>
        <div class="segmented" role="group" aria-label="Call For">
          <button type="button" class="seg active" data-group="callfor" data-value="self">Self</button>
          <button type="button" class="seg" data-group="callfor" data-value="proxy">Someone Else</button>
        </div>
      </div>
      <div id="noMatchBanner" class="banner hidden" aria-hidden="true">
        <span>No match for caller phone. Search patient by name/DOB.</span>
        <div style="margin-left:auto; display:flex; gap:6px; align-items:center;">
          <button class="btn ghost" type="button" id="showSearchBtn">Search Patient</button>
          <button class="btn ghost" type="button" id="copyCallerToSubjectBtn">Copy caller phone</button>
          <label class="checkbox" style="gap:6px">
            <input id="markCrmUpdate" type="checkbox" />
            <span class="checkmark" title="Mark for CRM update"></span>
            <small class="muted">Mark for CRM update</small>
          </label>
        </div>
      </div>
      <div class="grid">
        <label class="field"><span class="label">Name</span><input id="patientName" type="text" placeholder="—" autocomplete="off" /></label>
        <label class="field"><span class="label">Phone</span><input id="patientPhone" type="tel" placeholder="—" autocomplete="off" /></label>
        <label class="field"><span class="label">MRN</span><input id="patientMRN" type="text" placeholder="—" autocomplete="off" /></label>
        <label class="field"><span class="label">DOB</span><input id="patientDOB" type="date" /></label>
      </div>
      <div class="pt-type segmented" role="group" aria-label="Patient Type"><button type="button" class="seg" data-ptype="new">New</button><button type="button" class="seg active" data-ptype="existing">Existing</button></div>

      <!-- Subject search/apply shown when Call For = Someone Else -->
      <div id="subjectSearchWrap" class="grid hidden" aria-hidden="true" style="margin-top:.5rem">
        <label class="field"><span class="label">Subject Name</span><input id="subjectName" type="text" placeholder="Enter full name" autocomplete="off" /></label>
        <label class="field"><span class="label">Subject DOB</span><input id="subjectDOB" type="date" /></label>
        <label class="field"><span class="label">Subject MRN (optional)</span><input id="subjectMRN" type="text" placeholder="—" autocomplete="off" /></label>
        <label class="field"><span class="label">Subject Phone (optional)</span><input id="subjectPhone" type="tel" placeholder="—" autocomplete="off" /></label>
        <div class="field" style="grid-column: 1 / -1; display:flex; gap:.5rem; align-items:center;">
          <button class="btn" type="button" id="applySubjectBtn">Apply Subject</button>
          <button class="btn" type="button" id="findSubjectBtn">Find</button>
          <button class="btn ghost" type="button" id="switchPatientBtn">Switch/Clear</button>
          <small class="muted">Applies to patient fields; caller phone remains unchanged.</small>
        </div>
      </div>

      <!-- Household chooser / search results -->
      <div id="householdChooser" class="chooser hidden" aria-hidden="true">
        <div class="chooser-header">Possible matches for this caller</div>
        <div id="householdList" class="chooser-list"></div>
        <div class="chooser-actions" style="display:flex; align-items:center; gap:8px; justify-content:space-between; margin-top:6px;">
          <button class="btn ghost" type="button" id="householdSearchBtn">None of these → Search</button>
          <button class="icon-btn" type="button" id="closeHouseholdBtn" aria-label="Close chooser" title="Close">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
    </section>

    <section class="section">
      <h3 class="section-title"><i class="fa-regular fa-calendar"></i> Appointment Context</h3>
      <div class="row"><span class="label">Scheduled?</span><div class="segmented" role="group" aria-label="Scheduled"><button type="button" class="seg active" data-value="yes" data-group="scheduled">Yes</button><button type="button" class="seg" data-value="no" data-group="scheduled">No</button></div></div>
      <div class="row"><span class="label">Change</span><div class="segmented" role="group" aria-label="Change Type"><button type="button" class="seg active" data-value="none" data-group="change">None</button><button type="button" class="seg" data-value="cancellation" data-group="change">Cancellation</button><button type="button" class="seg" data-value="reschedule" data-group="change">Reschedule</button></div></div>
      <div id="reasonBlock" class="reason hidden">
        <div class="field">
          <span class="label">Reasons</span>
          <div id="reasonToggleList" class="reason-toggle-list" role="group" aria-label="Reasons for appointment change"></div>
        </div>
        <label id="otherReasonWrap" class="field hidden"><span class="label">Other (details)</span><input id="otherReason" type="text" placeholder="Enter details" /></label>
      </div>
    </section>

    <section class="section">
      <h3 class="section-title"><i class="fa-regular fa-message"></i> Other Call Reasons</h3>
      <div class="reasons">
        <div class="reason-row"><span class="reason-label">Confirmation</span><label class="checkbox"><input id="confirmCheck" type="checkbox" /><span class="checkmark"></span></label></div>
        <div class="reason-row"><span class="reason-label">MA Call</span><div class="actions"><button class="mini-btn" data-action="task">Task</button><button class="mini-btn alt" data-action="transfer">Transfer</button></div></div>
        <div class="reason-row"><span class="reason-label">Results</span><div class="actions"><button class="mini-btn" data-action="task">Task</button><button class="mini-btn alt" data-action="transfer">Transfer</button></div></div>
        <div class="reason-row"><span class="reason-label">Provider Question</span><div class="actions"><button class="mini-btn" data-action="task">Task</button><button class="mini-btn alt" data-action="transfer">Transfer</button></div></div>
        <div class="reason-row"><span class="reason-label">Refill Request</span><div class="actions"><button class="mini-btn" data-action="task">Task</button><button class="mini-btn alt" data-action="transfer">Transfer</button></div></div>
        <div class="reason-row"><span class="reason-label">Billing Question</span><div class="actions"><button class="mini-btn" data-action="task">Task</button><button class="mini-btn alt" data-action="transfer">Transfer</button></div></div>
      </div>
    </section>
    </div>

    <footer class="mini-footer">
      <div class="left"><small id="statusMsg" class="muted">Testing mode — use the scenario dropdown</small></div>
      <div class="right"><button class="btn ghost" id="clearBtn">Clear</button><button class="btn primary" id="doneBtn">Done</button></div>
    </footer>
  </div>

  <script src="screenpop.js?v=7"></script>
  <script src="screenpop.mock.js?v=7"></script>
  <script src="screenpop.logic.js?v=7"></script>
  <script src="screenpop.testing.js?v=7"></script>
</body>
</html>
